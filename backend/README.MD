# FIFO System - Backend ‚öôÔ∏è

Este diret√≥rio cont√©m o c√≥digo-fonte da API REST de alta performance do **FIFO System**, desenvolvida em **Go** com o framework **Gin**. A API √© respons√°vel por toda a l√≥gica de neg√≥cio, gest√£o de dados e comunica√ß√£o em tempo real da aplica√ß√£o.

## ‚ú® Arquitetura e Estrutura do Projeto

O backend segue uma arquitetura modular e organizada para garantir a separa√ß√£o de responsabilidades (*Separation of Concerns*), facilitando a manuten√ß√£o e escalabilidade.

  * **`main.go`**: Ponto de entrada da aplica√ß√£o. Respons√°vel por inicializar a base de dados, configurar o servidor Gin, definir as rotas (p√∫blicas e privadas), aplicar middlewares e iniciar o servidor.
  * **`Dockerfile`**: Ficheiro de constru√ß√£o do contentor. Utiliza uma abordagem multi-stage para criar uma imagem Docker final extremamente leve e segura, baseada em `alpine:latest`, contendo apenas o bin√°rio compilado da aplica√ß√£o.
  * **`/config`**: Gest√£o de configura√ß√£o. Carrega vari√°veis de ambiente a partir de um ficheiro `.env` (para desenvolvimento) ou do ambiente de execu√ß√£o (para produ√ß√£o no Cloud Run).
  * **`/controllers`**: Cont√©m a l√≥gica de manipula√ß√£o das requisi√ß√µes HTTP. Os controladores recebem os pedidos, validam os dados de entrada e orquestram as chamadas aos servi√ßos para executar a l√≥gica de neg√≥cio.
  * **`/initializers`**: Respons√°vel por inicializar as conex√µes centrais da aplica√ß√£o, como a liga√ß√£o √† base de dados PostgreSQL.
  * **`/middleware`**: Cont√©m os middlewares do Gin.
      * `requireAuth.go`: Interceta as requisi√ß√µes a rotas protegidas, valida o token JWT e injeta os dados do utilizador no contexto da requisi√ß√£o.
      * `RequirePermission`: Garante que o utilizador autenticado possui a permiss√£o espec√≠fica necess√°ria para aceder a um determinado *endpoint*.
  * **`/models`**: Define as estruturas de dados (entidades) que s√£o mapeadas para as tabelas da base de dados utilizando o GORM. Inclui `User`, `Role`, `Permission`, `Package` e `AuditLog`.
  * **`/services`**: Centraliza a l√≥gica de neg√≥cio reutiliz√°vel, como a cria√ß√£o de logs de auditoria e a gest√£o de tempo, garantindo consist√™ncia em toda a aplica√ß√£o.
  * **`/websocket`**: Implementa a comunica√ß√£o em tempo real utilizando WebSockets para funcionalidades como a lista de utilizadores online.

-----

## ‚òÅÔ∏è Deploy em Google Cloud Run

O backend foi projetado para ser executado como um servi√ßo *stateless* e escal√°vel no Google Cloud Run.

1.  **Containeriza√ß√£o:** O `Dockerfile` cria uma imagem de contentor otimizada. No primeiro est√°gio (`builder`), o c√≥digo Go √© compilado num √∫nico bin√°rio est√°tico. No segundo est√°gio, apenas este bin√°rio e os dados de fuso hor√°rio (`tzdata`) s√£o copiados para uma imagem base `alpine` m√≠nima, resultando numa imagem final segura e com poucos megabytes.
2.  **Envio para o Artifact Registry:** A imagem Docker gerada √© enviada para o Google Artifact Registry (o servi√ßo de registo de contentores da Google Cloud).
3.  **Implanta√ß√£o no Cloud Run:** Um novo servi√ßo √© criado no Cloud Run, utilizando a imagem do Artifact Registry. O Cloud Run gere automaticamente o provisionamento, a escalabilidade (incluindo a redu√ß√£o a zero para economizar custos) e a exposi√ß√£o do servi√ßo atrav√©s de um URL HTTPS seguro.
4.  **Gest√£o de Segredos:** Todas as vari√°veis de ambiente sens√≠veis, como a `DATABASE_URL` e o `JWT_SECRET`, s√£o configuradas de forma segura como "Segredos" no Secret Manager da Google Cloud e injetadas no ambiente de execu√ß√£o do Cloud Run.

-----

## üîë Configura√ß√£o de Vari√°veis de Ambiente (`.env`)

Para desenvolvimento local, o backend utiliza um ficheiro `.env` na sua raiz. **Este ficheiro n√£o deve ser enviado para o reposit√≥rio.**

```env
# String de Conex√£o para a base de dados PostgreSQL.
# Para desenvolvimento local, aponta para o contentor Docker do Postgres.
# Em produ√ß√£o (Cloud Run), esta vari√°vel cont√©m a connection string da Supabase.
DATABASE_URL="postgresql://USUARIO:SENHA@host:port/database"

# Segredo para assinatura do token JWT.
# Este valor DEVE ser longo, aleat√≥rio e mantido em segredo.
JWT_SECRET="SEU_SEGREDO_JWT_SUPER_SEGURO_AQUI"

# Tempo de expira√ß√£o do token (formatos aceites: "15m", "1h", "8h").
JWT_EXPIRATION_TIME="8h"

# Modo de execu√ß√£o do Gin ("debug" para desenvolvimento, "release" para produ√ß√£o).
GIN_MODE="debug"

# Porta em que a API ser√° executada dentro do contentor.
PORT="8080"

# URL do frontend para permitir requisi√ß√µes (CORS).
FRONTEND_URL="http://localhost:5173"
```

-----

## üöÄ Como Executar Localmente

### ‚úîÔ∏è Pr√©-requisitos

  * **Go (vers√£o 1.25 ou superior)** instalado.
  * Uma inst√¢ncia **PostgreSQL** em execu√ß√£o (pode ser via Docker, conforme o `docker-compose.yml` na raiz do projeto).

### ‚úîÔ∏è Passos

1.  **Navegue at√© a pasta do backend:**

    ```bash
    cd fifo-system/backend
    ```

2.  **Instale as depend√™ncias:**

    ```bash
    go mod tidy
    ```

3.  **Configure o ambiente local:**

      * Crie um ficheiro `.env` na raiz da pasta `backend`.
      * Preencha-o com as suas configura√ß√µes, apontando `DATABASE_URL` para a sua inst√¢ncia PostgreSQL e definindo um `JWT_SECRET`.

4.  **Execute a aplica√ß√£o:**

    ```bash
    go run main.go
    ```

A API estar√° em execu√ß√£o em [http://localhost:8080](https://www.google.com/search?q=http://localhost:8080) (ou na porta definida na sua vari√°vel `PORT`).